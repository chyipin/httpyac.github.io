(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{422:function(t,e,s){"use strict";s.r(e);var r=s(15),a=Object(r.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"scripting"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#scripting"}},[t._v("#")]),t._v(" Scripting")]),t._v(" "),s("p",[t._v("It is possible to use NodeJS scripts. All scripts before the request line are executed before the request is called. All scripts after the request line are executed as soon as the response is received. All exports of the script are stored as variables.")]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[t._v("{{\n  //pre request script\n  const crypto = require('crypto');\n  const date = new Date();\n  const signatureBase64 = crypto.createHmac('sha256', 'secret')\n  .update(`${request.method}\\u2028${request.url}\\u2028${date.getTime()}`).digest(\"base64\");\n  exports.authDate = date.toUTCString();\n  exports.authentcation = `Basic ${signatureBase64}`;\n}}\n"),s("span",{pre:!0,attrs:{class:"token request-line"}},[s("span",{pre:!0,attrs:{class:"token method property"}},[t._v("GET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token request-target url"}},[t._v("https://httpbin.org/json")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token http-version property"}},[t._v("HTTP/1.1")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Date:")]),t._v(" {{authDate}}\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Authentication:")]),t._v(' {{authentcation}}\n\n{{\n  // post request script\n  const assert = require(\'assert\');\n  test("author is valid", () => {\n    assert.equal(response.parsedBody.slideshow.author, "Yours Truly", );\n  });\n}}')])])]),s("h2",{attrs:{id:"access-to-variables"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#access-to-variables"}},[t._v("#")]),t._v(" Access to Variables")]),t._v(" "),s("p",[t._v("All Variables already defined can be accessed via the global scope.")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[t._v("Since all variables are placed on the global scope of the script, they may overwrite other variables. Please use unique variable names")])]),t._v(" "),s("p",[t._v("In addition to the defined variables, the following values are also set on global scope")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("name")]),t._v(" "),s("th",[t._v("description")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("request")]),t._v(" "),s("td",[t._v("request of the next "),s("a",{attrs:{href:"https://github.com/AnWeber/httpyac/blob/main/src/models/httpRequest.ts",target:"_blank",rel:"noopener noreferrer"}},[t._v("http request"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",[t._v("response")]),t._v(" "),s("td",[s("a",{attrs:{href:"https://github.com/AnWeber/httpyac/blob/main/src/models/httpResponse.ts",target:"_blank",rel:"noopener noreferrer"}},[t._v("http response"),s("OutboundLink")],1),t._v(" of the last request")])]),t._v(" "),s("tr",[s("td",[t._v("httpRegion")]),t._v(" "),s("td",[t._v("current "),s("a",{attrs:{href:"https://github.com/AnWeber/httpyac/blob/main/src/models/httpRegion.ts",target:"_blank",rel:"noopener noreferrer"}},[t._v("httpRegion"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",[t._v("httpFile")]),t._v(" "),s("td",[t._v("current "),s("a",{attrs:{href:"https://github.com/AnWeber/httpyac/blob/main/src/models/httpFile.ts",target:"_blank",rel:"noopener noreferrer"}},[t._v("httpFile"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",[t._v("test")]),t._v(" "),s("td",[t._v("method to simplify "),s("a",{attrs:{href:"https://github.com/AnWeber/httpyac/blob/main/src/actions/jsAction.ts#L40",target:"_blank",rel:"noopener noreferrer"}},[t._v("tests"),s("OutboundLink")],1),t._v(" ("),s("a",{attrs:{href:"https://github.com/AnWeber/httpyac/blob/main/examples/script/assert.http",target:"_blank",rel:"noopener noreferrer"}},[t._v("assert"),s("OutboundLink")],1),t._v(" or "),s("a",{attrs:{href:"https://github.com/AnWeber/httpyac/blob/main/examples/script/chai.http",target:"_blank",rel:"noopener noreferrer"}},[t._v("chai"),s("OutboundLink")],1),t._v(")")])])])]),t._v(" "),s("h2",{attrs:{id:"require"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#require"}},[t._v("#")]),t._v(" Require")]),t._v(" "),s("p",[t._v("External scripts can be imported using require, but you need to install dependencies yourself.")]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[t._v("\n{{\n  const { authenticate } = require('./scriptRequire');\n  const authDate = new Date();\n\n  exports.authDate = authDate.toUTCString();\n  exports.authentication = authenticate(authDate, request);\n}}\n\n"),s("span",{pre:!0,attrs:{class:"token request-line"}},[s("span",{pre:!0,attrs:{class:"token method property"}},[t._v("GET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token request-target url"}},[t._v("https://httpbin.org/json")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token http-version property"}},[t._v("HTTP/1.1")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Authentication:")]),t._v(" {{authentication}}\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Date:")]),t._v(" {{authDate}}")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("External dependencies must be installed independently, exceptions are "),s("a",{attrs:{href:"https://www.npmjs.com/package/@types/vscode",target:"_blank",rel:"noopener noreferrer"}},[t._v("vscode"),s("OutboundLink")],1),t._v(", "),s("a",{attrs:{href:"https://www.npmjs.com/package/got",target:"_blank",rel:"noopener noreferrer"}},[t._v("got"),s("OutboundLink")],1),t._v(" and "),s("a",{attrs:{href:"https://www.npmjs.com/package/httpyac",target:"_blank",rel:"noopener noreferrer"}},[t._v("httpYac"),s("OutboundLink")],1),t._v(" Dependency, which are provided from the extension.")])]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://nodejs.org/api/modules.html#modules_require_cache",target:"_blank",rel:"noopener noreferrer"}},[t._v("NodeJS"),s("OutboundLink")],1),t._v(" caches all loaded scripts. Since in VS Code the script is executed in the context of the extension, the content of the script is not reloaded. Therefore, the script must be manually removed from the cache. A helper method requireUncached is provided.")])]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[t._v("\n{{\n  const { authenticate } = requireUncached('./scriptRequire');\n  const authDate = new Date();\n\n  exports.authDate = authDate.toUTCString();\n  exports.authentication = authenticate(authDate, request);\n}}\n\n"),s("span",{pre:!0,attrs:{class:"token request-line"}},[s("span",{pre:!0,attrs:{class:"token method property"}},[t._v("GET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token request-target url"}},[t._v("https://httpbin.org/json")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token http-version property"}},[t._v("HTTP/1.1")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Authentication:")]),t._v(" {{authentication}}\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Date:")]),t._v(" {{authDate}}")])])]),s("h2",{attrs:{id:"console"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#console"}},[t._v("#")]),t._v(" Console")]),t._v(" "),s("p",[t._v("The console cannot be accessed in VS Code. Therefore, a separate Console object is provided in the context of the script that redirects the output to the OutputChannel.")]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[t._v("@foo = https://httpbin.org\n\n{{\n  console.info(foo);\n}}\n")])])]),s("h2",{attrs:{id:"test"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#test"}},[t._v("#")]),t._v(" Test")]),t._v(" "),s("p",[t._v("You can write easily test scripts in JavaScript. Tests allow you to ensure that your API is working as expected, to establish that integrations between services are functioning reliably, and to verify that new developments haven't broken any existing functionality. You can also use test code to aid the debugging process when something goes wrong with your API project.")]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[t._v("\n"),s("span",{pre:!0,attrs:{class:"token request-line"}},[s("span",{pre:!0,attrs:{class:"token method property"}},[t._v("GET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token request-target url"}},[t._v("https://httpbin.org/json")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token http-version property"}},[t._v("HTTP/1.1")])]),t._v("\n{{\n  const { equal } = require('assert');\n  test('status code 200', () => {\n    equal(response.statusCode, 200);\n  });\n}}")])])]),s("div",{staticClass:"language-http extra-class"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[t._v("\n"),s("span",{pre:!0,attrs:{class:"token request-line"}},[s("span",{pre:!0,attrs:{class:"token method property"}},[t._v("GET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token request-target url"}},[t._v("https://httpbin.org/json")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token http-version property"}},[t._v("HTTP/1.1")])]),t._v("\n\n{{\n  const { expect } = require('chai');\n  test('status code 200', () => {\n    expect(response.statusCode).to.equal(200)\n  });\n}}")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/AnWeber/httpyac/blob/790a1b0409bd9eed6ef0ff26a2fc017952d58231/src/models/testFunction.ts#L6-L14",target:"_blank",rel:"noopener noreferrer"}},[t._v("Auxiliary methods"),s("OutboundLink")],1),t._v(" are provided for standard tests such as Status and Content-Type")])]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[t._v("\n"),s("span",{pre:!0,attrs:{class:"token request-line"}},[s("span",{pre:!0,attrs:{class:"token method property"}},[t._v("GET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token request-target url"}},[t._v("https://httpbin.org/json")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token http-version property"}},[t._v("HTTP/1.1")])]),t._v("\n{{\n  const { equal } = require('assert');\n  test.status(200);\n}}")])])]),s("h2",{attrs:{id:"global-scripts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#global-scripts"}},[t._v("#")]),t._v(" Global Scripts")]),t._v(" "),s("p",[t._v("Scripts with no request in the same region are always executed (Global Scripts).")]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[t._v("{{\n  console.info('on every run')\n}}\n###\n"),s("span",{pre:!0,attrs:{class:"token request-line"}},[s("span",{pre:!0,attrs:{class:"token method property"}},[t._v("GET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token request-target url"}},[t._v("https://httpbin.org/json")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token http-version property"}},[t._v("HTTP/1.1")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token request-line"}},[s("span",{pre:!0,attrs:{class:"token method property"}},[t._v("GET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token request-target url"}},[t._v("https://httpbin.org/json")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token http-version property"}},[t._v("HTTP/1.1")])]),t._v("\n\n")])])]),s("p",[t._v("Global Scripts initialized with "),s("code",{pre:!0},[t._v("{{+")]),t._v(" are executed before every region.")]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("div",{staticClass:"highlight-lines"},[s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[t._v('{{+\n  console.info("on every request");\n}}\n###\n'),s("span",{pre:!0,attrs:{class:"token request-line"}},[s("span",{pre:!0,attrs:{class:"token method property"}},[t._v("GET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token request-target url"}},[t._v("https://httpbin.org/json")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token http-version property"}},[t._v("HTTP/1.1")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token request-line"}},[s("span",{pre:!0,attrs:{class:"token method property"}},[t._v("GET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token request-target url"}},[t._v("https://httpbin.org/json")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token http-version property"}},[t._v("HTTP/1.1")])]),t._v("\n\n")])])]),s("p",[t._v("Global Scripts initialized with "),s("code",{pre:!0},[t._v("{{+after")]),t._v(" are executed after every region.")]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("div",{staticClass:"highlight-lines"},[s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[t._v("{{+after\n  console.info(`on every request: ${response.statusCode}`);\n}}\n###\n"),s("span",{pre:!0,attrs:{class:"token request-line"}},[s("span",{pre:!0,attrs:{class:"token method property"}},[t._v("GET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token request-target url"}},[t._v("https://httpbin.org/json")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token http-version property"}},[t._v("HTTP/1.1")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token request-line"}},[s("span",{pre:!0,attrs:{class:"token method property"}},[t._v("GET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token request-target url"}},[t._v("https://httpbin.org/json")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token http-version property"}},[t._v("HTTP/1.1")])])])])]),s("h2",{attrs:{id:"intellij-script"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#intellij-script"}},[t._v("#")]),t._v(" Intellij Script")]),t._v(" "),s("p",[t._v("Intellij Scripts are supported. An "),s("a",{attrs:{href:"https://www.jetbrains.com/help/idea/http-client-reference.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Http client"),s("OutboundLink")],1),t._v(" and "),s("a",{attrs:{href:"https://www.jetbrains.com/help/idea/http-response-reference.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("response"),s("OutboundLink")],1),t._v(" object corresponding to the interface is created and are available in the script.")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[t._v("The execution environment differs between NodeJS and Intellij (uses Nashorn). Possibly the behavior is not completely identical, to Intellij Execution. If there are problems, please let me know.")])]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[s("span",{pre:!0,attrs:{class:"token request-line"}},[s("span",{pre:!0,attrs:{class:"token method property"}},[t._v("POST")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token request-target url"}},[t._v("https://httpbin.org/anything")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token http-version property"}},[t._v("HTTP/1.1")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Content-Type:")]),t._v(" application/x-www-form-urlencoded\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("accept:")]),t._v(" application/json\n\nemail=user@domain.loc&password=2\n\n> ./intellij.js\n\n"),s("span",{pre:!0,attrs:{class:"token request-line"}},[s("span",{pre:!0,attrs:{class:"token method property"}},[t._v("POST")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token request-target url"}},[t._v("https://httpbin.org/anything")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token http-version property"}},[t._v("HTTP/1.1")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Content-Type:")]),t._v(" application/x-www-form-urlencoded\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("accept:")]),t._v(' application/json\n\nemail=user@domain.loc&password=3\n\n> {% client.global.set("email", response.body.form.email); %}\n')])])]),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[t._v("Intellij scripts are always executed after request. Scripts before Request Line are ignored")])]),t._v(" "),s("h2",{attrs:{id:"how-to-debug-scripts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#how-to-debug-scripts"}},[t._v("#")]),t._v(" How to debug scripts")]),t._v(" "),s("ol",[s("li",[t._v("Install httpYac cli with "),s("code",[t._v("npm install httpyac -g")])]),t._v(" "),s("li",[t._v("open Http File in VS Code")]),t._v(" "),s("li",[t._v("add "),s("a",{attrs:{href:"https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Statements/debugger",target:"_blank",rel:"noopener noreferrer"}},[t._v("debugger;"),s("OutboundLink")],1),t._v(" statement in script")]),t._v(" "),s("li",[t._v("open "),s("a",{attrs:{href:"https://code.visualstudio.com/docs/nodejs/nodejs-debugging#_javascript-debug-terminal",target:"_blank",rel:"noopener noreferrer"}},[t._v("Javascript Debug Terminal"),s("OutboundLink")],1),t._v(" in VS Code")]),t._v(" "),s("li",[t._v("execute command "),s("code",[t._v("httpyac <file> -l <line>")])])]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[t._v("{{\n  //pre request script\n  const crypto = require('crypto');\n  const date = new Date();\n  const signatureBase64 = crypto.createHmac('sha256', 'secret')\n  .update(`${request.method}\\u2028${request.url}\\u2028${date.getTime()}`).digest(\"base64\");\n  debugger;\n  exports.authDate = date.toUTCString();\n  exports.authentcation = `Basic ${signatureBase64}`;\n}}\n"),s("span",{pre:!0,attrs:{class:"token request-line"}},[s("span",{pre:!0,attrs:{class:"token method property"}},[t._v("GET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token request-target url"}},[t._v("https://httpbin.org/json")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token http-version property"}},[t._v("HTTP/1.1")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Date:")]),t._v(" {{authDate}}\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Authentication:")]),t._v(" {{authentcation}}")])])])])}),[],!1,null,null,null);e.default=a.exports}}]);